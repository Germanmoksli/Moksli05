{% extends "base.html" %}
{% block title %}–°–æ–∑–¥–∞—Ç—å –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ{% endblock %}
{% block content %}
  <div class="mx-auto" style="max-width: 600px;">
    <h2 class="text-primary fw-bold fs-4 mb-4">–°–æ–∑–¥–∞—Ç—å –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ</h2>
    {# –ï—Å–ª–∏ –≤—ã–±—Ä–∞–Ω —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –≥–æ—Å—Ç—å –∏ —É –Ω–µ–≥–æ –µ—Å—Ç—å –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è, –æ—Ç–æ–±—Ä–∞–∑–∏–º –∏—Ö —Å–ø–∏—Å–æ–∫ –ø–µ—Ä–µ–¥ —Ñ–æ—Ä–º–æ–π #}
    {% if existing_bookings %}
    <div class="alert alert-info">
      <div class="fw-semibold mb-1">
        –ü—Ä–µ–¥—ã–¥—É—â–∏–µ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è{% if guest_name %} –≥–æ—Å—Ç—è {{ guest_name }}{% endif %}:
      </div>
      <div class="table-responsive">
        <table class="table table-sm table-striped">
          <thead>
            <tr>
              <th>–ö–≤–∞—Ä—Ç–∏—Ä–∞</th>
              <th>–ó–∞–µ–∑–¥</th>
              <th>–í—ã–µ–∑–¥</th>
              <th>–ö–æ–ª‚Äë–≤–æ —Å—É—Ç–æ–∫</th>
              <th>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π</th>
            </tr>
          </thead>
          <tbody>
            {% for b in existing_bookings %}
            <tr>
              <td>{{ b['room_number'] }}</td>
              <td>{{ b['check_in_date'] }}</td>
              <td>{{ b['check_out_date'] }}</td>
              <td>{{ b['nights'] }}</td>
              <td>{{ b['notes'] or '' }}</td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>
    {% endif %}
    <!-- –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Å—Ç–∏–ª–∏ —Ç–æ–ª—å–∫–æ –¥–ª—è —Ñ–æ—Ä–º—ã –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è -->
    <style>
      /* –£—Å–∏–ª–∏–≤–∞–µ–º –∑–∞–≥–æ–ª–æ–≤–∫–∏ –ø–æ–ª–µ–π –∏ –∑–∞–¥–∞—ë–º –ø—Ä–∏—è—Ç–Ω—ã–π —Ü–≤–µ—Ç —Ç–µ–∫—Å—Ç–∞,
         –Ω–æ —É–±–∏—Ä–∞–µ–º –ø–æ–¥—á—ë—Ä–∫–∏–≤–∞–Ω–∏–µ, —á—Ç–æ–±—ã —Ñ–æ—Ä–º–∞ –≤—ã–≥–ª—è–¥–µ–ª–∞ –ª–µ–≥—á–µ. */
      .booking-form .form-label {
        font-weight: 600;
        /* border-bottom removed per user request */
        padding-bottom: 2px;
      }
      .booking-form .form-control {
        color: #6c757d;
      }
    </style>
    <div class="booking-form">
    <form method="post" class="needs-validation" novalidate>
      {# Preserve scroll_date across form submission so that after saving the booking we can return to the same month/day in the calendar. #}
      {% if scroll_date %}
      <input type="hidden" name="scroll_date" value="{{ scroll_date }}">
      {% endif %}
      {# Include guest_id as a hidden field if passed in context. This allows the server to associate the booking
         with an existing guest instead of creating a new one. #}
      {% if guest_id %}
      <input type="hidden" name="guest_id" value="{{ guest_id }}">
      {% endif %}
      {# –°–∫—Ä—ã—Ç—ã–π input –¥–ª—è –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–≥–æ —Ç–µ–ª–µ—Ñ–æ–Ω–∞. –ó–∞–ø–æ–ª–Ω—è–µ—Ç—Å—è —á–µ—Ä–µ–∑ –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ. #}
      <input type="hidden" id="extra_phone" name="extra_phone">
    <!-- –ü–æ–ª–µ –¥–ª—è –∏–º–µ–Ω–∏ –∏ –≤—Å—Ç—Ä–æ–µ–Ω–Ω–∞—è –∫–Ω–æ–ø–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–≥–æ –Ω–æ–º–µ—Ä–∞ -->
    <div class="mb-3 clickable-field" style="max-width: 350px;" onclick="this.querySelector('input').focus();">
      <label for="guest_name" class="form-label">–ò–º—è</label>
      <div class="position-relative">
        {# –ü–æ–ª–µ "–ò–º—è" –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –ø—É—Å—Ç—ã–º –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é. –ò—Å–ø–æ–ª—å–∑—É–µ–º —Ñ–∏–ª—å—Ç—Ä default, —á—Ç–æ–±—ã None –∏–ª–∏ –Ω–µ–æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ
           –Ω–µ –æ—Ç–æ–±—Ä–∞–∂–∞–ª–æ—Å—å –∫–∞–∫ —Å—Ç—Ä–æ–∫–∞ "None". –ï—Å–ª–∏ guest_name —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –∏ –Ω–µ –ø—É—Å—Ç, –æ–Ω–æ –±—É–¥–µ—Ç –ø–æ–∫–∞–∑–∞–Ω–æ, –∏–Ω–∞—á–µ –±—É–¥–µ—Ç
           —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –ø—É—Å—Ç–æ–π value. #}
        <input type="text" class="form-control" id="guest_name" name="guest_name" placeholder="–ò–º—è"
               value="{{ guest_name | default('', true) }}" {% if guest_id %}disabled{% endif %}
               list="guest-names" style="padding-right: 2.25rem;">
        {# –û–±–µ—Ä—Ç–∫–∞ –¥–ª—è –∫–Ω–æ–ø–∫–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–≥–æ –Ω–æ–º–µ—Ä–∞; —Å–∫—Ä—ã—Ç–∞ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –∏ –ø–æ–∫–∞–∑–∞–Ω–∞ —Ç–æ–ª—å–∫–æ –¥–ª—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –≥–æ—Å—Ç–µ–π #}
        <div id="add-extra-phone-wrapper" style="display:none;">
          <button type="button" id="add-extra-phone-btn"
                  class="btn p-0 position-absolute top-50 translate-middle-y"
                  style="right: 5mm;"
                  data-bs-toggle="modal" data-bs-target="#extraPhoneModal" aria-label="–î–æ–±–∞–≤–∏—Ç—å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π –Ω–æ–º–µ—Ä">
            <i class="bi bi-plus-lg" style="font-size: 1.25rem; color: #119ffe;"></i>
          </button>
        </div>
      </div>
    </div>
    <!-- –ö–æ–¥ —Å—Ç—Ä–∞–Ω—ã, —Ç–µ–ª–µ—Ñ–æ–Ω –≥–æ—Å—Ç—è –∏ –≤—ã–±–æ—Ä –∫–≤–∞—Ä—Ç–∏—Ä—ã -->
    <div class="mb-3 row g-2 align-items-end">
      <!-- –ö–æ–¥ —Å—Ç—Ä–∞–Ω—ã -->
      <div class="col-auto clickable-field" onclick="this.querySelector('select').focus();">
        <label for="country_code" class="form-label">–ö–æ–¥</label>
        <select id="country_code" name="country_code" class="form-select">
          <!-- –ö–æ–¥ —Å—Ç—Ä–∞–Ω—ã –∏ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–π —Ñ–ª–∞–≥-—ç–º–æ–¥–∑–∏ -->
          <option value="+7" data-mask="(XXX) XXX XX XX" data-length="10" data-flag="üá∞üáø" selected>üá∞üáø +7</option>
          <option value="+1" data-mask="(XXX) XXX-XXXX" data-length="10" data-flag="üá∫üá∏">üá∫üá∏ +1</option>
          <option value="+44" data-mask="(XXXX) XXX XXXX" data-length="10" data-flag="üá¨üáß">üá¨üáß +44</option>
          <option value="+49" data-mask="(XXXX) XXX XXXX" data-length="10" data-flag="üá©üá™">üá©üá™ +49</option>
          <option value="+81" data-mask="(XXXX) XXX XXX" data-length="9" data-flag="üáØüáµ">üáØüáµ +81</option>
        </select>
      </div>
      <!-- –¢–µ–ª–µ—Ñ–æ–Ω –≥–æ—Å—Ç—è -->
      <div class="col clickable-field">
        <label for="phone" class="form-label">–¢–µ–ª–µ—Ñ–æ–Ω –≥–æ—Å—Ç—è</label>
        <!-- –í–≤–æ–¥ –æ—Å—Ç–∞–≤—à–µ–π—Å—è —á–∞—Å—Ç–∏ –Ω–æ–º–µ—Ä–∞; –∫–æ–¥ –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏. –î–ª—è —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ –≥–æ—Å—Ç—è –ø–æ–ª–µ –Ω–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ. -->
        <input type="tel" class="form-control" id="phone" name="phone" placeholder="(XXX) XXX XX XX" {% if not guest_id %}required{% endif %}
               list="guest-phones">
        <div class="invalid-feedback">–í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞ –¥–ª—è –≤—ã–±—Ä–∞–Ω–Ω–æ–π —Å—Ç—Ä–∞–Ω—ã.</div>
        <!-- –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ –æ —á—ë—Ä–Ω–æ–º —Å–ø–∏—Å–∫–µ -->
        <div id="blacklist-warning" class="form-text text-danger mt-1" style="display: none;">–≠—Ç–æ—Ç –Ω–æ–º–µ—Ä –≤ —á—ë—Ä–Ω–æ–º —Å–ø–∏—Å–∫–µ!</div>
        <!-- –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π —Ç–µ–ª–µ—Ñ–æ–Ω –±—É–¥–µ—Ç –≤–≤–æ–¥–∏—Ç—å—Å—è —á–µ—Ä–µ–∑ –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ. –ó–Ω–∞—á–µ–Ω–∏–µ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ —Å–∫—Ä—ã—Ç–æ–º –ø–æ–ª–µ extra_phone. -->
      </div>
      <!-- –í—ã–±–æ—Ä –∫–≤–∞—Ä—Ç–∏—Ä—ã -->
      <div class="col clickable-field" onclick="this.querySelector('select').focus();">
        <label for="room_id" class="form-label">–ö–≤–∞—Ä—Ç–∏—Ä–∞</label>
        <select class="form-select" id="room_id" name="room_id" required>
          <option value="" {% if not selected_room_id %}selected{% endif %} disabled>–í—ã–±–µ—Ä–∏—Ç–µ –∫–≤–∞—Ä—Ç–∏—Ä—É</option>
          {% for r in rooms %}
            <option value="{{ r['id'] }}" {% if selected_room_id and selected_room_id == r['id'] %}selected{% endif %}>{{ r['room_number'] }}</option>
          {% endfor %}
        </select>
        <div class="invalid-feedback">–í—ã–±–µ—Ä–∏—Ç–µ –∫–≤–∞—Ä—Ç–∏—Ä—É.</div>
      </div>
    </div>
    <!-- –ö–≤–∞—Ä—Ç–∏—Ä–∞ –≤—ã–≤–æ–¥–∏—Ç—Å—è —Ä—è–¥–æ–º —Å —Ç–µ–ª–µ—Ñ–æ–Ω–æ–º -->
    
    <!-- –î–∞—Ç—ã –∑–∞–µ–∑–¥–∞ –∏ –≤—ã–µ–∑–¥–∞ —Ä—è–¥–æ–º -->
    <div class="mb-3 row g-2 align-items-end">
      <div class="col clickable-field" onclick="this.querySelector('input').showPicker ? this.querySelector('input').showPicker() : this.querySelector('input').focus();">
        <label for="check_in" class="form-label">–î–∞—Ç–∞ –∑–∞–µ–∑–¥–∞</label>
        <input type="date" class="form-control" id="check_in" name="check_in" required value="{{ default_check_in }}">
        <div class="invalid-feedback">–£–∫–∞–∂–∏—Ç–µ –¥–∞—Ç—É –∑–∞–µ–∑–¥–∞.</div>
      </div>
      <div class="col clickable-field" onclick="this.querySelector('input').showPicker ? this.querySelector('input').showPicker() : this.querySelector('input').focus();">
        <label for="check_out" class="form-label">–î–∞—Ç–∞ –≤—ã–µ–∑–¥–∞</label>
        <input type="date" class="form-control" id="check_out" name="check_out" required value="{{ default_check_out }}">
        <div class="invalid-feedback">–£–∫–∞–∂–∏—Ç–µ –¥–∞—Ç—É –≤—ã–µ–∑–¥–∞.</div>
      </div>
    </div>
    {# –£–¥–∞–ª–µ–Ω–æ –ø–æ–ª–µ —Å—Ç–∞—Ç—É—Å–∞ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è #}
    <!-- –°—Ç–æ–∏–º–æ—Å—Ç—å: —Ü–µ–Ω–∞ –∑–∞ —Å—É—Ç–∫–∏ –∏ –æ–±—â–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å –≤ –æ–¥–Ω–æ–π —Å—Ç—Ä–æ–∫–µ -->
    <div class="mb-3 row g-2 align-items-end">
      <div class="col clickable-field" onclick="this.querySelector('input').focus();">
        <label for="total_amount" class="form-label">–¶–µ–Ω–∞ –∑–∞ —Å—É—Ç–∫–∏ (‚Ç∏)</label>
        <input type="number" step="0.01" class="form-control" id="total_amount" name="total_amount">
      </div>
      <div class="col clickable-field" onclick="this.querySelector('input').focus();">
        <label for="total_price_display" class="form-label">–û–±—â–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å (‚Ç∏)</label>
        <input type="text" class="form-control" id="total_price_display" readonly>
      </div>
    </div>
    <!-- –ë–ª–æ–∫ –¥–µ–ø–æ–∑–∏—Ç–∞ -->
    <div class="mb-3 row g-2 align-items-end">
      <div class="col clickable-field" onclick="this.querySelector('input').focus();">
        <label for="paid_amount" class="form-label">–°—É–º–º–∞ –¥–µ–ø–æ–∑–∏—Ç–∞ (‚Ç∏)</label>
        <input type="number" step="0.01" class="form-control" id="paid_amount" name="paid_amount">
      </div>
      <div class="col clickable-field" onclick="this.querySelector('select').focus();">
        <label for="deposit_status" class="form-label">–°—Ç–∞—Ç—É—Å –¥–µ–ø–æ–∑–∏—Ç–∞</label>
        <select id="deposit_status" name="deposit_status" class="form-select">
          <!-- –û–ø–ª–∞—á–µ–Ω: muted yellow, –í–æ–∑–≤—Ä–∞—â–µ–Ω: muted green -->
          <option value="paid" data-class="bg-warning-subtle text-dark">–û–ø–ª–∞—á–µ–Ω</option>
          <option value="withheld" data-class="bg-danger-subtle text-dark">–£–¥–µ—Ä–∂–∞–Ω</option>
          <option value="returned" data-class="bg-success-subtle text-dark">–í–æ–∑–≤—Ä–∞—â–µ–Ω</option>
        </select>
      </div>
    </div>
    <div class="mb-3 clickable-field" onclick="this.querySelector('textarea').focus();">
      <label for="notes" class="form-label">–ü—Ä–∏–º–µ—á–∞–Ω–∏—è</label>
      <textarea class="form-control" id="notes" name="notes" rows="3"></textarea>
    </div>
    <button type="submit" class="btn btn-primary">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
    {# –ù–∞ –∫–Ω–æ–ø–∫—É –û—Ç–º–µ–Ω–∞ –ø–µ—Ä–µ—Ö–æ–¥–∏–º –Ω–∞–∑–∞–¥ –≤ –∫–∞–ª–µ–Ω–¥–∞—Ä—å. –ï—Å–ª–∏ scroll_date –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω, –≤–æ–∑–≤—Ä–∞—â–∞–µ–º—Å—è –∫ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–µ–º—É –º–µ—Å—è—Ü—É. #}
    {% if scroll_date and scroll_year and scroll_month %}
      <a href="{{ url_for('calendar_view', year=scroll_year, month=scroll_month, scroll_date=scroll_date) }}" class="btn btn-soft-danger">–û—Ç–º–µ–Ω–∞</a>
    {% else %}
      <a href="{{ url_for('calendar_view') }}" class="btn btn-soft-danger">–û—Ç–º–µ–Ω–∞</a>
    {% endif %}
    </form>
    </div>
  </div>

  <!-- Modal –¥–ª—è –≤–≤–æ–¥–∞ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–≥–æ –Ω–æ–º–µ—Ä–∞ —Ç–µ–ª–µ—Ñ–æ–Ω–∞ -->
  <div class="modal fade" id="extraPhoneModal" tabindex="-1" aria-labelledby="extraPhoneModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="extraPhoneModalLabel">–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π –Ω–æ–º–µ—Ä</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="–ó–∞–∫—Ä—ã—Ç—å"></button>
        </div>
        <div class="modal-body">
          <div class="mb-3">
            <label class="form-label">–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π –Ω–æ–º–µ—Ä</label>
            <div class="row g-2">
              <div class="col-auto">
                <select id="extra_country_code" name="extra_country_code" class="form-select">
                  <!-- –ü–æ–≤—Ç–æ—Ä—è–µ–º —Å–ø–∏—Å–æ–∫ –∫–æ–¥–æ–≤ —Å—Ç—Ä–∞–Ω, –∞–Ω–∞–ª–æ–≥–∏—á–Ω—ã–π –æ—Å–Ω–æ–≤–Ω–æ–º—É –≤—ã–±–æ—Ä—É -->
                  <option value="+7" data-mask="(XXX) XXX XX XX" data-length="10" data-flag="üá∞üáø">üá∞üáø +7</option>
                  <option value="+1" data-mask="(XXX) XXX-XXXX" data-length="10" data-flag="üá∫üá∏">üá∫üá∏ +1</option>
                  <option value="+44" data-mask="(XXXX) XXX XXXX" data-length="10" data-flag="üá¨üáß">üá¨üáß +44</option>
                  <option value="+49" data-mask="(XXXX) XXX XXXX" data-length="10" data-flag="üá©üá™">üá©üá™ +49</option>
                  <option value="+81" data-mask="(XXXX) XXX XXX" data-length="9" data-flag="üáØüáµ">üáØüáµ +81</option>
                </select>
              </div>
              <div class="col">
                <input type="tel" class="form-control" id="extra_phone_input" placeholder="">
              </div>
            </div>
            <div class="form-text mt-1">–í–≤–µ–¥–∏—Ç–µ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π –Ω–æ–º–µ—Ä –≤ —Ç–æ–º –∂–µ —Ñ–æ—Ä–º–∞—Ç–µ, —á—Ç–æ –∏ –æ—Å–Ω–æ–≤–Ω–æ–π</div>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-primary" id="save-extra-phone-btn">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">–û—Ç–º–µ–Ω–∞</button>
        </div>
      </div>
    </div>
  </div>

  <script>
    (function () {
      'use strict'
      var forms = document.querySelectorAll('.needs-validation')
      Array.prototype.slice.call(forms)
        .forEach(function (form) {
          form.addEventListener('submit', function (event) {
            if (!form.checkValidity()) {
              event.preventDefault()
              event.stopPropagation()
            }
            form.classList.add('was-validated')
          }, false)
        })
    })()
  </script>
  <!-- –°–∫—Ä–∏–ø—Ç –¥–ª—è —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –ø—Ä–∏–≥–ª—É—à—ë–Ω–Ω—ã—Ö —Ñ–æ–Ω–æ–≤ –≤ –≤—ã–ø–∞–¥–∞—é—â–µ–º —Å–ø–∏—Å–∫–µ —Å—Ç–∞—Ç—É—Å–∞ –¥–µ–ø–æ–∑–∏—Ç–∞ -->
  <script>
    document.addEventListener('DOMContentLoaded', function () {
      var select = document.getElementById('deposit_status');
      if (select) {
        function updateDepositClass() {
          // –£–¥–∞–ª—è–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –∫–ª–∞—Å—Å—ã —Å –ø—Ä–∏–≥–ª—É—à—ë–Ω–Ω—ã–º–∏ —Ü–≤–µ—Ç–∞–º–∏
          select.classList.remove('bg-warning-subtle', 'bg-success-subtle', 'bg-danger-subtle', 'text-dark');
          // –ü–æ–ª—É—á–∞–µ–º –∞—Ç—Ä–∏–±—É—Ç data-class –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ –ø—É–Ω–∫—Ç–∞
          var opt = select.options[select.selectedIndex];
          var cls = opt.getAttribute('data-class');
          if (cls) {
            cls.split(/\s+/).forEach(function (c) {
              if (c) select.classList.add(c);
            });
          }
        }
        // –í—ã–∑—ã–≤–∞–µ–º –ø—Ä–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –∏ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏
        updateDepositClass();
        select.addEventListener('change', updateDepositClass);
      }
    });
  </script>
  <!-- –°–∫—Ä–∏–ø—Ç –¥–ª—è –≤—ã–±–æ—Ä–∞ –∫–æ–¥–∞ —Å—Ç—Ä–∞–Ω—ã –∏ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –Ω–æ–º–µ—Ä–∞ -->
  <script>
    document.addEventListener('DOMContentLoaded', function () {
      var countrySelect = document.getElementById('country_code');
      var phoneInput = document.getElementById('phone');
      // –ú–∞—Å—Å–∏–≤ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –Ω–æ–º–µ—Ä–æ–≤ (—Å–∞–Ω–∏—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ü–∏—Ñ—Ä—ã) –ø–µ—Ä–µ–¥–∞—ë—Ç—Å—è —Å —Å–µ—Ä–≤–µ—Ä–∞
      var blacklistedDigits = {{ blacklisted_numbers|tojson|safe if blacklisted_numbers is defined else '[]' }};
      var blacklistWarningEl = document.getElementById('blacklist-warning');
      // –•—Ä–∞–Ω–∏—Ç —Ç–µ–∫—É—â—É—é –º–∞—Å–∫—É –∏ –¥–ª–∏–Ω—É –¥–ª—è –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ –∫–æ–¥–∞ (–æ—Å–Ω–æ–≤–Ω–æ–π –Ω–æ–º–µ—Ä)
      var currentMask = '';
      var currentLength = 0;
      // –ú–∞—Å–∫–∞ –∏ –¥–ª–∏–Ω–∞ –¥–ª—è –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–≥–æ –Ω–æ–º–µ—Ä–∞ —Ç–µ–ª–µ—Ñ–æ–Ω–∞ (–≤ –º–æ–¥–∞–ª—å–Ω–æ–º –æ–∫–Ω–µ)
      var extraCurrentMask = '';
      var extraCurrentLength = 0;

      function updatePlaceholder() {
        var selected = countrySelect.options[countrySelect.selectedIndex];
        currentMask = selected.getAttribute('data-mask');
        currentLength = parseInt(selected.getAttribute('data-length'), 10) || 10;
        phoneInput.placeholder = currentMask;
        // –û—á–∏—Å—Ç–∏–º –ø–æ–ª–µ –ø—Ä–∏ —Å–º–µ–Ω–µ –∫–æ–¥–∞
        phoneInput.value = '';
        // –û–±–Ω–æ–≤–∏–º placeholder –¥–ª—è –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–≥–æ —Ç–µ–ª–µ—Ñ–æ–Ω–∞ –≤ –º–æ–¥–∞–ª—å–Ω–æ–º –æ–∫–Ω–µ, –µ—Å–ª–∏ –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É–µ—Ç, –∏ –æ—á–∏—Å—Ç–∏–º –∑–Ω–∞—á–µ–Ω–∏–µ
        var extraPhoneInputModal = document.getElementById('extra_phone_input');
        var extraCountrySelectEl = document.getElementById('extra_country_code');
        if (extraPhoneInputModal && extraCountrySelectEl) {
          // –ö–æ–≥–¥–∞ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –º–∞—Å–∫–∞ –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –Ω–æ–º–µ—Ä–∞, –µ—Å–ª–∏ –∫–æ–¥ —Å—Ç—Ä–∞–Ω—ã –≤ –º–æ–¥–∞–ª—å–Ω–æ–º –æ–∫–Ω–µ —Å–æ–≤–ø–∞–¥–∞–µ—Ç —Å –æ—Å–Ω–æ–≤–Ω—ã–º, –æ–±–Ω–æ–≤–ª—è–µ–º –∏ –º–∞—Å–∫—É –¥–ª—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ
          if (extraCountrySelectEl.value === countrySelect.value) {
            extraCurrentMask = currentMask;
            extraCurrentLength = currentLength;
            extraPhoneInputModal.placeholder = extraCurrentMask;
            extraPhoneInputModal.value = '';
          }
        }
      }

      // –û–±–Ω–æ–≤–ª—è–µ—Ç placeholder –∏ –º–∞—Å–∫—É –¥–ª—è –ø–æ–ª—è –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–≥–æ —Ç–µ–ª–µ—Ñ–æ–Ω–∞
      function updateExtraPlaceholder() {
        var extraCountrySelectEl = document.getElementById('extra_country_code');
        var extraPhoneInputModal = document.getElementById('extra_phone_input');
        if (!extraCountrySelectEl || !extraPhoneInputModal) return;
        var selected = extraCountrySelectEl.options[extraCountrySelectEl.selectedIndex];
        extraCurrentMask = selected.getAttribute('data-mask');
        extraCurrentLength = parseInt(selected.getAttribute('data-length'), 10) || 10;
        extraPhoneInputModal.placeholder = extraCurrentMask;
        // –û—á–∏—Å—Ç–∏—Ç—å —Ç–µ–∫—É—â–µ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –ø—Ä–∏ —Å–º–µ–Ω–µ –∫–æ–¥–∞
        extraPhoneInputModal.value = '';
      }

      // –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ—Ç –≤–≤–µ–¥—ë–Ω–Ω—ã–µ —Ü–∏—Ñ—Ä—ã —Å–æ–≥–ª–∞—Å–Ω–æ —Ç–µ–∫—É—â–µ–π –º–∞—Å–∫–µ
      function formatNumber(digits) {
        var result = '';
        var digitIndex = 0;
        for (var i = 0; i < currentMask.length; i++) {
          var ch = currentMask[i];
          if (ch === 'X') {
            if (digitIndex < digits.length) {
              result += digits[digitIndex++];
            } else {
              break;
            }
          } else {
            result += ch;
          }
        }
        return result;
      }

      // –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ—Ç –≤–≤–µ–¥—ë–Ω–Ω—ã–µ —Ü–∏—Ñ—Ä—ã —Å–æ–≥–ª–∞—Å–Ω–æ –º–∞—Å–∫–µ –¥–ª—è –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–≥–æ –Ω–æ–º–µ—Ä–∞
      function formatExtraNumber(digits) {
        var result = '';
        var digitIndex = 0;
        for (var i = 0; i < extraCurrentMask.length; i++) {
          var ch = extraCurrentMask[i];
          if (ch === 'X') {
            if (digitIndex < digits.length) {
              result += digits[digitIndex++];
            } else {
              break;
            }
          } else {
            result += ch;
          }
        }
        return result;
      }

      // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –≤–≤–æ–¥–∞ —Ü–∏—Ñ—Ä –≤ –ø–æ–ª–µ —Ç–µ–ª–µ—Ñ–æ–Ω–∞
      phoneInput.addEventListener('input', function () {
        var digits = phoneInput.value.replace(/\D/g, '');
        if (digits.length > currentLength) {
          digits = digits.slice(0, currentLength);
        }
        phoneInput.value = formatNumber(digits);
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –ª–∏ –ø–æ–ª–Ω—ã–π –Ω–æ–º–µ—Ä –≤ —á–µ—Ä–Ω–æ–º —Å–ø–∏—Å–∫–µ
        var codeDigits = countrySelect.value.replace(/\D/g, '');
        var fullDigits = codeDigits + digits;
        if (blacklistedDigits.indexOf(fullDigits) !== -1) {
          if (blacklistWarningEl) blacklistWarningEl.style.display = 'block';
        } else {
          if (blacklistWarningEl) blacklistWarningEl.style.display = 'none';
        }
      });

      // –ï—Å–ª–∏ –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É–µ—Ç –ø–æ–ª–µ –¥–ª—è –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–≥–æ —Ç–µ–ª–µ—Ñ–æ–Ω–∞, –¥–æ–±–∞–≤–∏–º –∞–Ω–∞–ª–æ–≥–∏—á–Ω—ã–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏
      var extraPhoneInputModal = document.getElementById('extra_phone_input');
      if (extraPhoneInputModal) {
        extraPhoneInputModal.addEventListener('input', function () {
          var digits = extraPhoneInputModal.value.replace(/\D/g, '');
          if (digits.length > extraCurrentLength) {
            digits = digits.slice(0, extraCurrentLength);
          }
          extraPhoneInputModal.value = formatExtraNumber(digits);
        });
        extraPhoneInputModal.addEventListener('keydown', function (e) {
          if (e.key === 'Backspace') {
            e.preventDefault();
            var digits = extraPhoneInputModal.value.replace(/\D/g, '');
            if (digits.length > 0) {
              digits = digits.slice(0, -1);
              extraPhoneInputModal.value = formatExtraNumber(digits);
            }
          }
        });
        extraPhoneInputModal.addEventListener('focus', function () {
          var len = extraPhoneInputModal.value.length;
          extraPhoneInputModal.setSelectionRange(len, len);
        });
      }

      // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –Ω–∞–∂–∞—Ç–∏—è Backspace: —É–¥–∞–ª—è–µ–º –ø–æ—Å–ª–µ–¥–Ω—é—é —Ü–∏—Ñ—Ä—É –±–µ–∑ —É—á—ë—Ç–∞ —Ä–∞–∑–¥–µ–ª–∏—Ç–µ–ª–µ–π
      phoneInput.addEventListener('keydown', function (e) {
        if (e.key === 'Backspace') {
          e.preventDefault();
          var digits = phoneInput.value.replace(/\D/g, '');
          if (digits.length > 0) {
            digits = digits.slice(0, -1);
            phoneInput.value = formatNumber(digits);
          }
        }
      });

      // –ü—Ä–∏ —Ñ–æ–∫—É—Å–µ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∫—É—Ä—Å–æ—Ä –≤ –∫–æ–Ω–µ—Ü
      phoneInput.addEventListener('focus', function () {
        var len = phoneInput.value.length;
        phoneInput.setSelectionRange(len, len);
      });

      // –ü—Ä–∏ —Å–º–µ–Ω–µ –∫–æ–¥–∞ —Å—Ç—Ä–∞–Ω—ã –æ–±–Ω–æ–≤–ª—è–µ–º –º–∞—Å–∫—É –∏ –æ—á–∏—â–∞–µ–º –ø–æ–ª–µ —Ç–µ–ª–µ—Ñ–æ–Ω–∞
      countrySelect.addEventListener('change', function () {
        updatePlaceholder();
        // –ü—Ä–∏ —Å–º–µ–Ω–µ –∫–æ–¥–∞ —Ç–∞–∫–∂–µ –ø—Ä–æ–≤–µ—Ä—è–µ–º —á–µ—Ä–Ω—ã–π —Å–ø–∏—Å–æ–∫
        var digits = phoneInput.value.replace(/\D/g, '');
        var codeDigits = countrySelect.value.replace(/\D/g, '');
        var fullDigits = codeDigits + digits;
        if (blacklistedDigits.indexOf(fullDigits) !== -1) {
          if (blacklistWarningEl) blacklistWarningEl.style.display = 'block';
        } else {
          if (blacklistWarningEl) blacklistWarningEl.style.display = 'none';
        }
      });

      // –ï—Å–ª–∏ –µ—Å—Ç—å —Å–µ–ª–µ–∫—Ç–æ—Ä –∫–æ–¥–∞ —Å—Ç—Ä–∞–Ω—ã –≤ –º–æ–¥–∞–ª—å–Ω–æ–º –æ–∫–Ω–µ, –¥–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ —Å–º–µ–Ω—ã –∫–æ–¥–∞
      var extraCountrySelectEl = document.getElementById('extra_country_code');
      if (extraCountrySelectEl) {
        extraCountrySelectEl.addEventListener('change', function () {
          updateExtraPlaceholder();
        });
      }

      // –ù–∞—á–∞–ª—å–Ω–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
      updatePlaceholder();

      // –ù–∞—á–∞–ª—å–Ω–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –º–∞—Å–∫–∏ –¥–ª—è –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–≥–æ —Ç–µ–ª–µ—Ñ–æ–Ω–∞
      updateExtraPlaceholder();
    });
  </script>

  <!-- –°–∫—Ä–∏–ø—Ç –∞–≤—Ç–æ–∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è –∏–º–µ–Ω–∏/—Ç–µ–ª–µ—Ñ–æ–Ω–∞ –Ω–∞ –æ—Å–Ω–æ–≤–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –≥–æ—Å—Ç–µ–π –∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–≥–æ –Ω–æ–º–µ—Ä–∞ -->
  <script>
    document.addEventListener('DOMContentLoaded', function () {
      // Data passed from Flask: list of objects with name and phone properties
      var guestData = {{ guest_autocomplete_data|tojson|safe if guest_autocomplete_data is defined else '[]' }};
      var nameInput = document.getElementById('guest_name');
      var phoneInput = document.getElementById('phone');
      var countrySelect = document.getElementById('country_code');
      var addExtraWrapper = document.getElementById('add-extra-phone-wrapper');
      var addExtraBtn = document.getElementById('add-extra-phone-btn');
      // –°–∫—Ä—ã—Ç—ã–π input, –≤ –∫–æ—Ç–æ—Ä—ã–π –±—É–¥–µ—Ç –ø–æ–º–µ—â—ë–Ω –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞
      var extraPhoneHidden = document.getElementById('extra_phone');

      // –≠–ª–µ–º–µ–Ω—Ç—ã –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ –¥–ª—è –≤–≤–æ–¥–∞ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–≥–æ –Ω–æ–º–µ—Ä–∞
      var extraCountrySelect = document.getElementById('extra_country_code');
      var extraPhoneInputField = document.getElementById('extra_phone_input');
      var saveExtraPhoneBtn = document.getElementById('save-extra-phone-btn');

      // Global flag to prevent recursive phone filling
      var isFillingPhone = false;

      // Helper: fill phone field and country code from a full phone number (e.g. '+77072534455').
      // Uses a slight delay when setting the phone value to ensure the change event
      // on the country select has been fully processed (which resets the mask and clears the phone input).
      function fillPhone(fullPhone) {
        if (!fullPhone) return;
        // Prevent recursion
        if (isFillingPhone) return;
        isFillingPhone = true;
        var digits = fullPhone.replace(/\D/g, '');
        // Determine best matching country code
        var options = countrySelect ? countrySelect.options : [];
        var matchedOption = null;
        var matchedLen = 0;
        for (var i = 0; i < options.length; i++) {
          var opt = options[i];
          var codeDigits = opt.value.replace(/\D/g, '');
          if (digits.startsWith(codeDigits) && codeDigits.length > matchedLen) {
            matchedOption = opt;
            matchedLen = codeDigits.length;
          }
        }
        if (matchedOption) {
          countrySelect.value = matchedOption.value;
          // Trigger change to update mask and placeholder
          countrySelect.dispatchEvent(new Event('change'));
          // Remaining digits after country code
          var localDigits = digits.slice(matchedLen);
          // Delay setting the phone to ensure mask reset happens first
          setTimeout(function () {
            phoneInput.value = localDigits;
            // Trigger input event to format the number according to the current mask
            phoneInput.dispatchEvent(new Event('input'));
            isFillingPhone = false;
          }, 0);
        } else {
          // If no matching option found, clear the flag immediately
          isFillingPhone = false;
        }
      }

      function fillFromName() {
        var nameVal = nameInput ? nameInput.value.trim() : '';
        if (!nameVal) return;
        for (var i = 0; i < guestData.length; i++) {
          if (guestData[i].name === nameVal) {
            fillPhone(guestData[i].phone);
            // Show the add extra phone button
            if (addExtraWrapper) addExtraWrapper.style.display = 'block';
            return;
          }
        }
      }

      function fillFromPhone() {
        if (!phoneInput) return;
        // If we are currently filling the phone programmatically, skip further processing to avoid recursion
        if (isFillingPhone) return;
        var phoneDigits = phoneInput.value.replace(/\D/g, '');
        if (!phoneDigits) return;
        // Compose full digits including selected country code
        var codeDigits = countrySelect ? countrySelect.value.replace(/\D/g, '') : '';
        var fullDigits = codeDigits + phoneDigits;
        for (var i = 0; i < guestData.length; i++) {
          var guestDigits = guestData[i].phone.replace(/\D/g, '');
          // Only fill when the digits match exactly (full number match)
          if (guestDigits === fullDigits) {
            // Reformat the phone properly using the stored phone value
            fillPhone(guestData[i].phone);
            // Populate the name and show add-extra button
            if (nameInput) nameInput.value = guestData[i].name;
            if (addExtraWrapper) addExtraWrapper.style.display = 'block';
            return;
          }
        }
      }
      if (nameInput) {
        // When typing or selecting from the name datalist, check for exact match to auto-fill phone
        nameInput.addEventListener('input', fillFromName);
        nameInput.addEventListener('change', fillFromName);
        // Also handle blur (losing focus) to ensure phone is filled after selection
        nameInput.addEventListener('blur', fillFromName);
      }
      if (phoneInput) {
        // When typing or selecting from datalist, check for exact phone match to auto-fill name
        phoneInput.addEventListener('input', fillFromPhone);
        phoneInput.addEventListener('change', fillFromPhone);
      }
      // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–≥–æ —Ç–µ–ª–µ—Ñ–æ–Ω–∞ –∏–∑ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
      if (saveExtraPhoneBtn) {
        saveExtraPhoneBtn.addEventListener('click', function () {
          if (!extraCountrySelect || !extraPhoneInputField || !extraPhoneHidden) return;
          // –ü–æ–ª—É—á–∞–µ–º –∫–æ–¥ —Å—Ç—Ä–∞–Ω—ã –∏ –æ—á–∏—â–µ–Ω–Ω—ã–π –Ω–æ–º–µ—Ä
          var codeVal = extraCountrySelect.value || '';
          var digits = extraPhoneInputField.value.replace(/\D/g, '');
          // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ–±—ã –Ω–æ–º–µ—Ä –±—ã–ª –Ω–µ–ø—É—Å—Ç—ã–º
          if (digits.length === 0) {
            // –ï—Å–ª–∏ –ø—É—Å—Ç–æ–µ –ø–æ–ª–µ, –ø—Ä–æ—Å—Ç–æ –∑–∞–∫—Ä—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
            var modalEl = document.getElementById('extraPhoneModal');
            var bsModal = bootstrap.Modal.getInstance(modalEl);
            if (bsModal) bsModal.hide();
            return;
          }
          // –§–æ—Ä–º–∏—Ä—É–µ–º –ø–æ–ª–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ —Å +
          var fullNumber = codeVal + digits;
          // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ —Å–∫—Ä—ã—Ç–æ–µ –ø–æ–ª–µ –¥–ª—è –ø–µ—Ä–µ–¥–∞—á–∏ –Ω–∞ —Å–µ—Ä–≤–µ—Ä
          extraPhoneHidden.value = fullNumber;
          // –ó–∞–∫—Ä—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
          var modalEl2 = document.getElementById('extraPhoneModal');
          var bsModal2 = bootstrap.Modal.getInstance(modalEl2);
          if (bsModal2) bsModal2.hide();
        });
      }

      // –ü—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ (–∫–ª–∏–∫ –Ω–∞ –ø–ª—é—Å) —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ–º –∫–æ–¥ —Å—Ç—Ä–∞–Ω—ã –∏ –º–∞—Å–∫—É
      if (addExtraBtn) {
        addExtraBtn.addEventListener('click', function () {
          // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∫–æ–¥ —Å—Ç—Ä–∞–Ω—ã –≤ –º–æ–¥–∞–ª—å–Ω–æ–º –æ–∫–Ω–µ —Ä–∞–≤–Ω—ã–º –≤—ã–±—Ä–∞–Ω–Ω–æ–º—É –≤ –æ—Å–Ω–æ–≤–Ω–æ–º —Å–µ–ª–µ–∫—Ç–æ—Ä–µ
          if (countrySelect && extraCountrySelect) {
            extraCountrySelect.value = countrySelect.value;
          }
          // –û–±–Ω–æ–≤–ª—è–µ–º –º–∞—Å–∫—É –∏ placeholder –¥–ª—è –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–≥–æ —Ç–µ–ª–µ—Ñ–æ–Ω–∞
          updateExtraPlaceholder();
          // –û—á–∏—â–∞–µ–º –ø–æ–ª–µ –≤–≤–æ–¥–∞ –ø–µ—Ä–µ–¥ –ø–æ–∫–∞–∑–æ–º
          if (extraPhoneInputField) {
            extraPhoneInputField.value = '';
          }
        });
      }
    });
  </script>

  <!-- –°–∫—Ä–∏–ø—Ç –¥–ª—è —Ä–∞—Å—á—ë—Ç–∞ –æ–±—â–µ–π —Å—Ç–æ–∏–º–æ—Å—Ç–∏ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è -->
  <script>
    document.addEventListener('DOMContentLoaded', function () {
      var checkInInput = document.getElementById('check_in');
      var checkOutInput = document.getElementById('check_out');
      var rateInput = document.getElementById('total_amount');
      var totalDisplay = document.getElementById('total_price_display');

      function updateTotalPrice() {
        var checkInVal = checkInInput.value;
        var checkOutVal = checkOutInput.value;
        var rate = parseFloat(rateInput.value);
        if (checkInVal && checkOutVal && !isNaN(rate)) {
          var startDate = new Date(checkInVal);
          var endDate = new Date(checkOutVal);
          // –í—ã—á–∏—Å–ª—è–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –Ω–æ—á–µ–π, –≤—ã–µ–∑–¥–Ω—ã–π –¥–µ–Ω—å –Ω–µ –æ–ø–ª–∞—á–∏–≤–∞–µ—Ç—Å—è
          var diffMs = endDate - startDate;
          var nights = Math.floor(diffMs / (1000 * 60 * 60 * 24));
          // –ï—Å–ª–∏ –¥–∞—Ç–∞ –≤—ã–µ–∑–¥–∞ —Å–æ–≤–ø–∞–¥–∞–µ—Ç —Å –¥–∞—Ç–æ–π –∑–∞–µ–∑–¥–∞ –∏–ª–∏ –º–µ–Ω—å—à–µ (–æ—à–∏–±–æ—á–Ω—ã–π –≤–≤–æ–¥), —Å—á–∏—Ç–∞–µ–º 1 –Ω–æ—á—å.
          // –≠—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç —Å—Ä–∞–∑—É —É–≤–∏–¥–µ—Ç—å —Å—Ç–æ–∏–º–æ—Å—Ç—å –∑–∞ –æ–¥–Ω—É –Ω–æ—á—å, –∫–æ–≥–¥–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤—ã–±–∏—Ä–∞–µ—Ç –æ–¥–∏–Ω–∞–∫–æ–≤—ã–µ –¥–∞—Ç—ã.
          if (nights <= 0) {
            // –ù—É–ª–µ–≤–∞—è –∏–ª–∏ –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω–∞—è –ø—Ä–æ–¥–æ–ª–∂–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å: –µ—Å–ª–∏ –º–µ–Ω—å—à–µ –Ω—É–ª—è, –Ω–µ —Å—á–∏—Ç–∞–µ–º (–æ—à–∏–±–∫–∞)
            if (nights < 0) {
              totalDisplay.value = '';
              return;
            }
            nights = 1;
          }
          var total = (rate * nights).toFixed(2);
          totalDisplay.value = total;
        } else {
          totalDisplay.value = '';
        }
      }

      // –û–±–Ω–æ–≤–ª—è–µ–º –æ–±—â—É—é —Å—Ç–æ–∏–º–æ—Å—Ç—å –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –¥–∞—Ç—ã –∑–∞–µ–∑–¥–∞/–≤—ã–µ–∑–¥–∞ –∏–ª–∏ —Ü–µ–Ω—ã –∑–∞ —Å—É—Ç–∫–∏.
      // –ò—Å–ø–æ–ª—å–∑—É–µ–º –∫–∞–∫ —Å–æ–±—ã—Ç–∏—è change, —Ç–∞–∫ –∏ input, —á—Ç–æ–±—ã –æ–±—Ä–∞–±–æ—Ç–∞—Ç—å –≤–≤–æ–¥ –≤—Ä—É—á–Ω—É—é –∏ –≤—ã–±–æ—Ä –∏–∑ –∫–∞–ª–µ–Ω–¥–∞—Ä—è.
      ['change', 'input'].forEach(function(evt) {
        checkInInput.addEventListener(evt, updateTotalPrice);
        checkOutInput.addEventListener(evt, updateTotalPrice);
        rateInput.addEventListener(evt, updateTotalPrice);
      });
      // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è: –≤—ã—á–∏—Å–ª—è–µ–º —Å—Ç–æ–∏–º–æ—Å—Ç—å —Å—Ä–∞–∑—É –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Ñ–æ—Ä–º—ã
      updateTotalPrice();
    });
  </script>
{% endblock %}