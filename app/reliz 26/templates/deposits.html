{% extends "base.html" %}
{% block title %}Депозиты{% endblock %}
{% block content %}

  <h2 class="text-primary fw-bold fs-4 mb-3">Депозиты</h2>

  <!-- Навигация по вкладкам: текущие и возвращённые депозиты -->
  <ul class="nav nav-tabs mb-3" id="depositTabs" role="tablist">
    <li class="nav-item" role="presentation">
      <button class="nav-link active" id="current-tab" data-bs-toggle="tab" data-bs-target="#current" type="button" role="tab" aria-controls="current" aria-selected="true">Текущие</button>
    </li>
    <li class="nav-item" role="presentation">
      <button class="nav-link" id="returned-tab" data-bs-toggle="tab" data-bs-target="#returned" type="button" role="tab" aria-controls="returned" aria-selected="false">Возвращённые</button>
    </li>
  </ul>

  <div class="tab-content" id="depositTabsContent">
    <!-- Текущие депозиты: статусы Оплачен и Удержан -->
    <div class="tab-pane fade show active" id="current" role="tabpanel" aria-labelledby="current-tab">
      <div class="table-responsive">
        <table class="table table-bordered table-sm">
          <thead class="table-light">
            <tr>
              <th>Гость</th>
              <th>Квартира</th>
              <th>Заезд</th>
              <th>Выезд</th>
              <th>Сумма депозита (₸)</th>
              <th>Менеджер</th>
              <th>Статус</th>
            </tr>
          </thead>
          <tbody>
            {% for d in deposits_current %}
              <tr>
                <td>{{ d.guest_name }}</td>
                <td>{{ d.room_number }}</td>
                <td>{{ d.check_in_date }}</td>
                <td>{{ d.check_out_date }}</td>
                <td>{{ (d.paid_amount|currency) if d.paid_amount else '' }}</td>
                <td>{{ d.manager_name or '' }}</td>
                <td>
                  <form method="post" action="{{ url_for('update_deposit_status', booking_id=d.id) }}">
                    <select name="deposit_status" class="form-select form-select-sm" onchange="this.form.submit()">
                      <option value="paid" {% if d.status == 'paid' %}selected{% endif %}>Оплачен</option>
                      <option value="withheld" {% if d.status == 'withheld' %}selected{% endif %}>Удержан</option>
                      <option value="returned" {% if d.status == 'returned' %}selected{% endif %}>Возвращен</option>
                    </select>
                  </form>
                </td>
              </tr>
            {% else %}
              <tr>
                <td colspan="6" class="text-center text-muted">Нет текущих депозитов</td>
              </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>
    <!-- Возвращённые депозиты -->
    <div class="tab-pane fade" id="returned" role="tabpanel" aria-labelledby="returned-tab">
      <div class="table-responsive">
        <table class="table table-bordered table-sm">
          <thead class="table-light">
            <tr>
              <th>Гость</th>
              <th>Квартира</th>
              <th>Заезд</th>
              <th>Выезд</th>
              <th>Сумма депозита (₸)</th>
              <th>Менеджер</th>
              <th>Статус</th>
            </tr>
          </thead>
          <tbody>
            {% for d in deposits_returned %}
              <tr>
                <td>{{ d.guest_name }}</td>
                <td>{{ d.room_number }}</td>
                <td>{{ d.check_in_date }}</td>
                <td>{{ d.check_out_date }}</td>
                <td>{{ (d.paid_amount|currency) if d.paid_amount else '' }}</td>
                <td>{{ d.manager_name or '' }}</td>
                <td>
                  <form method="post" action="{{ url_for('update_deposit_status', booking_id=d.id) }}">
                    <select name="deposit_status" class="form-select form-select-sm" onchange="this.form.submit()">
                      <option value="paid" {% if d.status == 'paid' %}selected{% endif %}>Оплачен</option>
                      <option value="withheld" {% if d.status == 'withheld' %}selected{% endif %}>Удержан</option>
                      <option value="returned" {% if d.status == 'returned' %}selected{% endif %}>Возвращен</option>
                    </select>
                  </form>
                </td>
              </tr>
            {% else %}
              <tr>
                <td colspan="6" class="text-center text-muted">Нет возвращённых депозитов</td>
              </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>
  </div>

{% endblock %}